{
  "version": 3,
  "sources": [],
  "sections": [
    {"offset": {"line": 4, "column": 0}, "map": {"version":3,"sources":["file:///X:/Apps/MelodyMakerStudio/lib/env.ts"],"sourcesContent":["import { createEnv } from \"@t3-oss/env-nextjs\";\nimport { z } from \"zod\";\n\nexport const env = createEnv({\n  /**\n   * Run `build` or `dev` with `SKIP_ENV_VALIDATION` to skip env validation. This is especially\n   * useful for Docker builds.\n   */\n  skipValidation: !!process.env.SKIP_ENV_VALIDATION,\n\n  /**\n   * Specify your server-side environment variables schema here. This way you can ensure the app\n   * isn't built with invalid env vars.\n   */\n  server: {\n    /* -----------------------------------------------------------------------------------------------\n     * Node.js Environment\n     * -----------------------------------------------------------------------------------------------*/\n\n    NODE_ENV: z\n      .enum([\"development\", \"test\", \"production\"])\n      .default(\"development\"),\n\n    /* -----------------------------------------------------------------------------------------------\n     * Firebase Configuration (Server-side)\n     * -----------------------------------------------------------------------------------------------*/\n\n    FIREBASE_PROJECT_ID: z\n      .string()\n      .min(1, { message: \"Firebase Project ID is invalid or missing\" }),\n    FIREBASE_CLIENT_EMAIL: z\n      .string()\n      .email({ message: \"Firebase Client Email is invalid or missing\" }),\n    FIREBASE_PRIVATE_KEY: z\n      .string()\n      .min(1, { message: \"Firebase Private Key is invalid or missing\" }),\n\n    /* -----------------------------------------------------------------------------------------------\n     * JioSaavn API URL (https://github.com/mehedihasan2810/jiosaavn-api-ts)\n     * -----------------------------------------------------------------------------------------------*/\n\n    JIOSAAVN_API_URL: z\n      .string()\n      .url({ message: \"JioSaavn API URL is invalid or missing\" })\n      .optional(),\n\n    /* -----------------------------------------------------------------------------------------------\n     * Upstash Rate Limiting (Redis)\n     * -----------------------------------------------------------------------------------------------*/\n\n    UPSTASH_REDIS_REST_URL: z.string().url().optional(),\n    UPSTASH_REDIS_REST_TOKEN: z.string().optional(),\n    ENABLE_RATE_LIMITING: z.enum([\"true\", \"false\"]).default(\"false\"),\n    RATE_LIMITING_REQUESTS_PER_SECOND: z.coerce.number().default(50),\n\n    /* -----------------------------------------------------------------------------------------------\n     * Umami Analytics\n     * -----------------------------------------------------------------------------------------------*/\n    UMAMI_WEBSITE_ID: z.string().optional(),\n  },\n\n  /**\n   * Specify your client-side environment variables schema here. This way you can ensure the app\n   * isn't built with invalid env vars. To expose them to the client, prefix them with\n   * `NEXT_PUBLIC_`.\n   */\n  client: {\n    NEXT_PUBLIC_FIREBASE_API_KEY: z.string(),\n    NEXT_PUBLIC_FIREBASE_AUTH_DOMAIN: z.string(),\n    NEXT_PUBLIC_FIREBASE_PROJECT_ID: z.string(),\n    NEXT_PUBLIC_FIREBASE_STORAGE_BUCKET: z.string(),\n    NEXT_PUBLIC_FIREBASE_MESSAGING_SENDER_ID: z.string(),\n    NEXT_PUBLIC_FIREBASE_APP_ID: z.string(),\n  },\n\n  /**\n   * You can't destruct `process.env` as a regular object in the Next.js edge runtimes (e.g.\n   * middlewares) or client-side so we need to destruct manually.\n   * For Next.js >= 13.4.4, you only need to destructure client variables (Only valid for `experimental__runtimeEnv`)\n   */\n  experimental__runtimeEnv: {\n    NEXT_PUBLIC_FIREBASE_API_KEY: process.env.NEXT_PUBLIC_FIREBASE_API_KEY,\n    NEXT_PUBLIC_FIREBASE_AUTH_DOMAIN:\n      process.env.NEXT_PUBLIC_FIREBASE_AUTH_DOMAIN,\n    NEXT_PUBLIC_FIREBASE_PROJECT_ID:\n      process.env.NEXT_PUBLIC_FIREBASE_PROJECT_ID,\n    NEXT_PUBLIC_FIREBASE_STORAGE_BUCKET:\n      process.env.NEXT_PUBLIC_FIREBASE_STORAGE_BUCKET,\n    NEXT_PUBLIC_FIREBASE_MESSAGING_SENDER_ID:\n      process.env.NEXT_PUBLIC_FIREBASE_MESSAGING_SENDER_ID,\n    NEXT_PUBLIC_FIREBASE_APP_ID: process.env.NEXT_PUBLIC_FIREBASE_APP_ID,\n  },\n\n  /**\n   * Makes it so that empty strings are treated as undefined.\n   * `SOME_VAR: z.string()` and `SOME_VAR=''` will throw an error.\n   */\n  emptyStringAsUndefined: true,\n});\n"],"names":[],"mappings":";;;;AAQoB;AARpB;AACA;;;AAEO,MAAM,MAAM,IAAA,6KAAS,EAAC;IAC3B;;;GAGC,GACD,gBAAgB,CAAC,CAAC,2KAAO,CAAC,GAAG,CAAC,mBAAmB;IAEjD;;;GAGC,GACD,QAAQ;QACN;;sGAEkG,GAElG,UAAU,0KAAC,CACR,IAAI,CAAC;YAAC;YAAe;YAAQ;SAAa,EAC1C,OAAO,CAAC;QAEX;;sGAEkG,GAElG,qBAAqB,0KAAC,CACnB,MAAM,GACN,GAAG,CAAC,GAAG;YAAE,SAAS;QAA4C;QACjE,uBAAuB,0KAAC,CACrB,MAAM,GACN,KAAK,CAAC;YAAE,SAAS;QAA8C;QAClE,sBAAsB,0KAAC,CACpB,MAAM,GACN,GAAG,CAAC,GAAG;YAAE,SAAS;QAA6C;QAElE;;sGAEkG,GAElG,kBAAkB,0KAAC,CAChB,MAAM,GACN,GAAG,CAAC;YAAE,SAAS;QAAyC,GACxD,QAAQ;QAEX;;sGAEkG,GAElG,wBAAwB,0KAAC,CAAC,MAAM,GAAG,GAAG,GAAG,QAAQ;QACjD,0BAA0B,0KAAC,CAAC,MAAM,GAAG,QAAQ;QAC7C,sBAAsB,0KAAC,CAAC,IAAI,CAAC;YAAC;YAAQ;SAAQ,EAAE,OAAO,CAAC;QACxD,mCAAmC,0KAAC,CAAC,MAAM,CAAC,MAAM,GAAG,OAAO,CAAC;QAE7D;;sGAEkG,GAClG,kBAAkB,0KAAC,CAAC,MAAM,GAAG,QAAQ;IACvC;IAEA;;;;GAIC,GACD,QAAQ;QACN,8BAA8B,0KAAC,CAAC,MAAM;QACtC,kCAAkC,0KAAC,CAAC,MAAM;QAC1C,iCAAiC,0KAAC,CAAC,MAAM;QACzC,qCAAqC,0KAAC,CAAC,MAAM;QAC7C,0CAA0C,0KAAC,CAAC,MAAM;QAClD,6BAA6B,0KAAC,CAAC,MAAM;IACvC;IAEA;;;;GAIC,GACD,0BAA0B;QACxB,4BAA4B;QAC5B,gCAAgC;QAEhC,+BAA+B;QAE/B,mCAAmC;QAEnC,wCAAwC;QAExC,2BAA2B;IAC7B;IAEA;;;GAGC,GACD,wBAAwB;AAC1B"}},
    {"offset": {"line": 94, "column": 0}, "map": {"version":3,"sources":["file:///X:/Apps/MelodyMakerStudio/lib/firebase-client.ts"],"sourcesContent":["import { initializeApp, getApps } from \"firebase/app\";\r\nimport { getAuth } from \"firebase/auth\";\r\nimport { getFirestore } from \"firebase/firestore\";\r\nimport { getStorage } from \"firebase/storage\";\r\nimport { env } from \"./env\";\r\n\r\nconst firebaseConfig = {\r\n  apiKey: env.NEXT_PUBLIC_FIREBASE_API_KEY,\r\n  authDomain: env.NEXT_PUBLIC_FIREBASE_AUTH_DOMAIN,\r\n  projectId: env.NEXT_PUBLIC_FIREBASE_PROJECT_ID,\r\n  storageBucket: env.NEXT_PUBLIC_FIREBASE_STORAGE_BUCKET,\r\n  messagingSenderId: env.NEXT_PUBLIC_FIREBASE_MESSAGING_SENDER_ID,\r\n  appId: env.NEXT_PUBLIC_FIREBASE_APP_ID,\r\n};\r\n\r\n// Initialize Firebase (only once)\r\nconsole.log(\"Initializing Firebase Client...\");\r\nconst app =\r\n  getApps().length === 0 ? initializeApp(firebaseConfig) : getApps()[0];\r\nconsole.log(\"Firebase Client Initialized\");\r\n\r\nexport const auth = getAuth(app);\r\nexport const db = getFirestore(app, \"mmsdb\");\r\nexport const storage = getStorage(app);\r\n"],"names":[],"mappings":";;;;;;;;AAAA;AAAA;AACA;AAAA;AACA;AAAA;AACA;AAAA;AACA;;;;;;AAEA,MAAM,iBAAiB;IACrB,QAAQ,oHAAG,CAAC,4BAA4B;IACxC,YAAY,oHAAG,CAAC,gCAAgC;IAChD,WAAW,oHAAG,CAAC,+BAA+B;IAC9C,eAAe,oHAAG,CAAC,mCAAmC;IACtD,mBAAmB,oHAAG,CAAC,wCAAwC;IAC/D,OAAO,oHAAG,CAAC,2BAA2B;AACxC;AAEA,kCAAkC;AAClC,QAAQ,GAAG,CAAC;AACZ,MAAM,MACJ,IAAA,8KAAO,IAAG,MAAM,KAAK,IAAI,IAAA,oLAAa,EAAC,kBAAkB,IAAA,8KAAO,GAAE,CAAC,EAAE;AACvE,QAAQ,GAAG,CAAC;AAEL,MAAM,OAAO,IAAA,wKAAO,EAAC;AACrB,MAAM,KAAK,IAAA,kLAAY,EAAC,KAAK;AAC7B,MAAM,UAAU,IAAA,8KAAU,EAAC"}},
    {"offset": {"line": 138, "column": 0}, "map": {"version":3,"sources":["file:///X:/Apps/MelodyMakerStudio/lib/auth-helpers.ts"],"sourcesContent":["\"use server\";\r\n\r\nimport { cookies } from \"next/headers\";\r\nimport { adminAuth } from \"./firebase-admin\";\r\n\r\n/**\r\n * Get the current user from Firebase session cookie\r\n * Server-side only\r\n */\r\nexport async function getServerUser() {\r\n    const cookieStore = await cookies();\r\n    const sessionCookie = cookieStore.get(\"session\")?.value;\r\n    if (!sessionCookie) return null;\r\n\r\n    try {\r\n        const decodedClaims = await adminAuth.verifySessionCookie(\r\n            sessionCookie,\r\n            true\r\n        );\r\n        return await adminAuth.getUser(decodedClaims.uid);\r\n    } catch (error) {\r\n        console.error(\"Error verifying session:\", error);\r\n        return null;\r\n    }\r\n}\r\n\r\n/**\r\n * Require authentication - throws error if not authenticated\r\n * Use this in server actions that require authentication\r\n */\r\nexport async function requireAuth() {\r\n    const user = await getServerUser();\r\n    if (!user) {\r\n        throw new Error(\"Unauthorized - Please sign in\");\r\n    }\r\n    return user;\r\n}\r\n\r\n/**\r\n * Create session cookie from Firebase ID token\r\n * Call this from a server action after successful login\r\n */\r\nexport async function createSessionCookie(idToken: string) {\r\n    const expiresIn = 60 * 60 * 24 * 5 * 1000; // 5 days\r\n\r\n    try {\r\n        const sessionCookie = await adminAuth.createSessionCookie(idToken, {\r\n            expiresIn,\r\n        });\r\n\r\n        const cookieStore = await cookies();\r\n        cookieStore.set(\"session\", sessionCookie, {\r\n            maxAge: expiresIn,\r\n            httpOnly: true,\r\n            secure: process.env.NODE_ENV === \"production\",\r\n            sameSite: \"lax\",\r\n            path: \"/\",\r\n        });\r\n\r\n        return { success: true };\r\n    } catch (error) {\r\n        console.error(\"Error creating session cookie:\", error);\r\n        return { success: false, error: \"Failed to create session\" };\r\n    }\r\n}\r\n\r\n/**\r\n * Delete session cookie\r\n * Call this on sign out\r\n */\r\nexport async function deleteSessionCookie() {\r\n    const cookieStore = await cookies();\r\n    cookieStore.delete(\"session\");\r\n}\r\n\r\n/**\r\n * Verify ID token and return user\r\n */\r\nexport async function verifyIdToken(idToken: string) {\r\n    try {\r\n        const decodedToken = await adminAuth.verifyIdToken(idToken);\r\n        return await adminAuth.getUser(decodedToken.uid);\r\n    } catch (error) {\r\n        console.error(\"Error verifying ID token:\", error);\r\n        return null;\r\n    }\r\n}\r\n"],"names":[],"mappings":";;;;;;;IA0CsB,sBAAA,WAAA,GAAA,IAAA,kPAAA,EAAA,8CAAA,uOAAA,EAAA,KAAA,GAAA,6OAAA,EAAA"}},
    {"offset": {"line": 153, "column": 0}, "map": {"version":3,"sources":["file:///X:/Apps/MelodyMakerStudio/lib/auth-helpers.ts"],"sourcesContent":["\"use server\";\r\n\r\nimport { cookies } from \"next/headers\";\r\nimport { adminAuth } from \"./firebase-admin\";\r\n\r\n/**\r\n * Get the current user from Firebase session cookie\r\n * Server-side only\r\n */\r\nexport async function getServerUser() {\r\n    const cookieStore = await cookies();\r\n    const sessionCookie = cookieStore.get(\"session\")?.value;\r\n    if (!sessionCookie) return null;\r\n\r\n    try {\r\n        const decodedClaims = await adminAuth.verifySessionCookie(\r\n            sessionCookie,\r\n            true\r\n        );\r\n        return await adminAuth.getUser(decodedClaims.uid);\r\n    } catch (error) {\r\n        console.error(\"Error verifying session:\", error);\r\n        return null;\r\n    }\r\n}\r\n\r\n/**\r\n * Require authentication - throws error if not authenticated\r\n * Use this in server actions that require authentication\r\n */\r\nexport async function requireAuth() {\r\n    const user = await getServerUser();\r\n    if (!user) {\r\n        throw new Error(\"Unauthorized - Please sign in\");\r\n    }\r\n    return user;\r\n}\r\n\r\n/**\r\n * Create session cookie from Firebase ID token\r\n * Call this from a server action after successful login\r\n */\r\nexport async function createSessionCookie(idToken: string) {\r\n    const expiresIn = 60 * 60 * 24 * 5 * 1000; // 5 days\r\n\r\n    try {\r\n        const sessionCookie = await adminAuth.createSessionCookie(idToken, {\r\n            expiresIn,\r\n        });\r\n\r\n        const cookieStore = await cookies();\r\n        cookieStore.set(\"session\", sessionCookie, {\r\n            maxAge: expiresIn,\r\n            httpOnly: true,\r\n            secure: process.env.NODE_ENV === \"production\",\r\n            sameSite: \"lax\",\r\n            path: \"/\",\r\n        });\r\n\r\n        return { success: true };\r\n    } catch (error) {\r\n        console.error(\"Error creating session cookie:\", error);\r\n        return { success: false, error: \"Failed to create session\" };\r\n    }\r\n}\r\n\r\n/**\r\n * Delete session cookie\r\n * Call this on sign out\r\n */\r\nexport async function deleteSessionCookie() {\r\n    const cookieStore = await cookies();\r\n    cookieStore.delete(\"session\");\r\n}\r\n\r\n/**\r\n * Verify ID token and return user\r\n */\r\nexport async function verifyIdToken(idToken: string) {\r\n    try {\r\n        const decodedToken = await adminAuth.verifyIdToken(idToken);\r\n        return await adminAuth.getUser(decodedToken.uid);\r\n    } catch (error) {\r\n        console.error(\"Error verifying ID token:\", error);\r\n        return null;\r\n    }\r\n}\r\n"],"names":[],"mappings":";;;;;;;IAsEsB,sBAAA,WAAA,GAAA,IAAA,kPAAA,EAAA,8CAAA,uOAAA,EAAA,KAAA,GAAA,6OAAA,EAAA"}},
    {"offset": {"line": 168, "column": 0}, "map": {"version":3,"sources":["file:///X:/Apps/MelodyMakerStudio/contexts/auth-context.tsx"],"sourcesContent":["\"use client\";\r\n\r\nimport { createContext, useContext, useEffect, useState } from \"react\";\r\nimport {\r\n    User,\r\n    onAuthStateChanged,\r\n    signInWithEmailAndPassword,\r\n    createUserWithEmailAndPassword,\r\n    signOut as firebaseSignOut,\r\n    signInWithPopup,\r\n    GoogleAuthProvider,\r\n    GithubAuthProvider,\r\n} from \"firebase/auth\";\r\nimport { auth } from \"@/lib/firebase-client\";\r\nimport { createSessionCookie, deleteSessionCookie } from \"@/lib/auth-helpers\";\r\n\r\ninterface AuthContextType {\r\n    user: User | null;\r\n    loading: boolean;\r\n    signIn: (email: string, password: string) => Promise<void>;\r\n    signUp: (email: string, password: string) => Promise<void>;\r\n    signOut: () => Promise<void>;\r\n    signInWithGoogle: () => Promise<void>;\r\n    signInWithGithub: () => Promise<void>;\r\n}\r\n\r\nconst AuthContext = createContext<AuthContextType>({} as AuthContextType);\r\n\r\nexport function AuthProvider({ children }: { children: React.ReactNode }) {\r\n    const [user, setUser] = useState<User | null>(null);\r\n    const [loading, setLoading] = useState(true);\r\n\r\n    useEffect(() => {\r\n        console.log(\"AuthProvider: Mounting...\");\r\n        const unsubscribe = onAuthStateChanged(auth, (user) => {\r\n            console.log(\"AuthProvider: Auth state changed\", user ? \"User logged in\" : \"No user\");\r\n            setUser(user);\r\n            setLoading(false);\r\n        });\r\n        return unsubscribe;\r\n    }, []);\r\n\r\n    const signIn = async (email: string, password: string) => {\r\n        console.log(\"AuthContext: Attempting sign in for\", email);\r\n        try {\r\n            const userCredential = await signInWithEmailAndPassword(auth, email, password);\r\n            console.log(\"AuthContext: Firebase sign in successful, getting token...\");\r\n            const idToken = await userCredential.user.getIdToken();\r\n            console.log(\"AuthContext: Got token, creating session cookie...\");\r\n            const result = await createSessionCookie(idToken);\r\n            if (!result.success) {\r\n                console.error(\"AuthContext: Session cookie creation failed:\", result.error);\r\n                throw new Error(result.error || \"Failed to create session\");\r\n            }\r\n            console.log(\"AuthContext: Session cookie created successfully\");\r\n        } catch (error) {\r\n            console.error(\"AuthContext: Sign in error:\", error);\r\n            throw error;\r\n        }\r\n    };\r\n\r\n    const signUp = async (email: string, password: string) => {\r\n        const userCredential = await createUserWithEmailAndPassword(\r\n            auth,\r\n            email,\r\n            password\r\n        );\r\n        const idToken = await userCredential.user.getIdToken();\r\n        await createSessionCookie(idToken);\r\n    };\r\n\r\n    const signOut = async () => {\r\n        await firebaseSignOut(auth);\r\n        await deleteSessionCookie();\r\n    };\r\n\r\n    const signInWithGoogle = async () => {\r\n        const provider = new GoogleAuthProvider();\r\n        const userCredential = await signInWithPopup(auth, provider);\r\n        const idToken = await userCredential.user.getIdToken();\r\n        await createSessionCookie(idToken);\r\n    };\r\n\r\n    const signInWithGithub = async () => {\r\n        const provider = new GithubAuthProvider();\r\n        const userCredential = await signInWithPopup(auth, provider);\r\n        const idToken = await userCredential.user.getIdToken();\r\n        await createSessionCookie(idToken);\r\n    };\r\n\r\n    return (\r\n        <AuthContext.Provider\r\n            value={{\r\n                user,\r\n                loading,\r\n                signIn,\r\n                signUp,\r\n                signOut,\r\n                signInWithGoogle,\r\n                signInWithGithub,\r\n            }}\r\n        >\r\n            {children}\r\n        </AuthContext.Provider>\r\n    );\r\n}\r\n\r\nexport const useAuth = () => {\r\n    const context = useContext(AuthContext);\r\n    if (!context) {\r\n        throw new Error(\"useAuth must be used within an AuthProvider\");\r\n    }\r\n    return context;\r\n};\r\n"],"names":[],"mappings":";;;;;;;AAEA;AACA;AAAA;AAUA;AACA;AAAA;;;AAdA;;;;;AA0BA,MAAM,4BAAc,IAAA,8KAAa,EAAkB,CAAC;AAE7C,SAAS,aAAa,EAAE,QAAQ,EAAiC;;IACpE,MAAM,CAAC,MAAM,QAAQ,GAAG,IAAA,yKAAQ,EAAc;IAC9C,MAAM,CAAC,SAAS,WAAW,GAAG,IAAA,yKAAQ,EAAC;IAEvC,IAAA,0KAAS;kCAAC;YACN,QAAQ,GAAG,CAAC;YACZ,MAAM,cAAc,IAAA,mLAAkB,EAAC,oIAAI;sDAAE,CAAC;oBAC1C,QAAQ,GAAG,CAAC,oCAAoC,OAAO,mBAAmB;oBAC1E,QAAQ;oBACR,WAAW;gBACf;;YACA,OAAO;QACX;iCAAG,EAAE;IAEL,MAAM,SAAS,OAAO,OAAe;QACjC,QAAQ,GAAG,CAAC,uCAAuC;QACnD,IAAI;YACA,MAAM,iBAAiB,MAAM,IAAA,2LAA0B,EAAC,oIAAI,EAAE,OAAO;YACrE,QAAQ,GAAG,CAAC;YACZ,MAAM,UAAU,MAAM,eAAe,IAAI,CAAC,UAAU;YACpD,QAAQ,GAAG,CAAC;YACZ,MAAM,SAAS,MAAM,IAAA,qKAAmB,EAAC;YACzC,IAAI,CAAC,OAAO,OAAO,EAAE;gBACjB,QAAQ,KAAK,CAAC,gDAAgD,OAAO,KAAK;gBAC1E,MAAM,IAAI,MAAM,OAAO,KAAK,IAAI;YACpC;YACA,QAAQ,GAAG,CAAC;QAChB,EAAE,OAAO,OAAO;YACZ,QAAQ,KAAK,CAAC,+BAA+B;YAC7C,MAAM;QACV;IACJ;IAEA,MAAM,SAAS,OAAO,OAAe;QACjC,MAAM,iBAAiB,MAAM,IAAA,+LAA8B,EACvD,oIAAI,EACJ,OACA;QAEJ,MAAM,UAAU,MAAM,eAAe,IAAI,CAAC,UAAU;QACpD,MAAM,IAAA,qKAAmB,EAAC;IAC9B;IAEA,MAAM,UAAU;QACZ,MAAM,IAAA,wKAAe,EAAC,oIAAI;QAC1B,MAAM,IAAA,qKAAmB;IAC7B;IAEA,MAAM,mBAAmB;QACrB,MAAM,WAAW,IAAI,mLAAkB;QACvC,MAAM,iBAAiB,MAAM,IAAA,gLAAe,EAAC,oIAAI,EAAE;QACnD,MAAM,UAAU,MAAM,eAAe,IAAI,CAAC,UAAU;QACpD,MAAM,IAAA,qKAAmB,EAAC;IAC9B;IAEA,MAAM,mBAAmB;QACrB,MAAM,WAAW,IAAI,mLAAkB;QACvC,MAAM,iBAAiB,MAAM,IAAA,gLAAe,EAAC,oIAAI,EAAE;QACnD,MAAM,UAAU,MAAM,eAAe,IAAI,CAAC,UAAU;QACpD,MAAM,IAAA,qKAAmB,EAAC;IAC9B;IAEA,qBACI,6LAAC,YAAY,QAAQ;QACjB,OAAO;YACH;YACA;YACA;YACA;YACA;YACA;YACA;QACJ;kBAEC;;;;;;AAGb;GA7EgB;KAAA;AA+ET,MAAM,UAAU;;IACnB,MAAM,UAAU,IAAA,2KAAU,EAAC;IAC3B,IAAI,CAAC,SAAS;QACV,MAAM,IAAI,MAAM;IACpB;IACA,OAAO;AACX;IANa"}},
    {"offset": {"line": 282, "column": 0}, "map": {"version":3,"sources":["file:///X:/Apps/MelodyMakerStudio/contexts/player-context.tsx"],"sourcesContent":["\"use client\";\r\n\r\nimport React, { createContext, useContext, useState, useRef, useEffect } from \"react\";\r\nimport { Song } from \"@/lib/db/firestore-schema\";\r\n\r\ninterface PlayerContextType {\r\n    currentTrack: Song | null;\r\n    playlist: Song[];\r\n    isPlaying: boolean;\r\n    volume: number;\r\n    isMuted: boolean;\r\n    currentTime: number;\r\n    duration: number;\r\n    playTrack: (song: Song) => void;\r\n    togglePlay: () => void;\r\n    setPlaylist: (songs: Song[]) => void;\r\n    playNext: () => void;\r\n    playPrev: () => void;\r\n    setVolume: (volume: number) => void;\r\n    toggleMute: () => void;\r\n    seek: (time: number) => void;\r\n    audioRef: React.RefObject<HTMLAudioElement>;\r\n}\r\n\r\nconst PlayerContext = createContext<PlayerContextType | undefined>(undefined);\r\n\r\nexport function PlayerProvider({ children }: { children: React.ReactNode }) {\r\n    const [currentTrack, setCurrentTrack] = useState<Song | null>(null);\r\n    const [playlist, setPlaylistState] = useState<Song[]>([]);\r\n    const [isPlaying, setIsPlaying] = useState(false);\r\n    const [volume, setVolumeState] = useState(70);\r\n    const [isMuted, setIsMuted] = useState(false);\r\n    const [currentTime, setCurrentTime] = useState(0);\r\n    const [duration, setDuration] = useState(0);\r\n\r\n    const audioRef = useRef<HTMLAudioElement>(null);\r\n\r\n    // Update volume when state changes\r\n    useEffect(() => {\r\n        if (audioRef.current) {\r\n            audioRef.current.volume = isMuted ? 0 : volume / 100;\r\n        }\r\n    }, [volume, isMuted]);\r\n\r\n    // Handle Play/Pause\r\n    useEffect(() => {\r\n        if (!audioRef.current) return;\r\n\r\n        if (isPlaying) {\r\n            const playPromise = audioRef.current.play();\r\n            if (playPromise !== undefined) {\r\n                playPromise.catch((error) => {\r\n                    console.error(\"Playback failed:\", error);\r\n                    setIsPlaying(false);\r\n                });\r\n            }\r\n        } else {\r\n            audioRef.current.pause();\r\n        }\r\n    }, [isPlaying, currentTrack]); // Re-run when track changes to ensure auto-play\r\n\r\n    const playTrack = (song: Song) => {\r\n        if (currentTrack?.id === song.id) {\r\n            togglePlay();\r\n        } else {\r\n            setCurrentTrack(song);\r\n            setIsPlaying(true);\r\n        }\r\n    };\r\n\r\n    const togglePlay = () => {\r\n        setIsPlaying(!isPlaying);\r\n    };\r\n\r\n    const setPlaylist = (songs: Song[]) => {\r\n        setPlaylistState(songs);\r\n    };\r\n\r\n    const playNext = () => {\r\n        if (!currentTrack || playlist.length === 0) return;\r\n        const currentIndex = playlist.findIndex((s) => s.id === currentTrack.id);\r\n        if (currentIndex < playlist.length - 1) {\r\n            playTrack(playlist[currentIndex + 1]);\r\n        } else {\r\n            // Loop to start or stop? Let's stop for now, or loop to first.\r\n            // Let's stop.\r\n            setIsPlaying(false);\r\n            setCurrentTime(0);\r\n        }\r\n    };\r\n\r\n    const playPrev = () => {\r\n        if (!currentTrack || playlist.length === 0) return;\r\n        // If more than 3 seconds in, restart track\r\n        if (currentTime > 3) {\r\n            seek(0);\r\n            return;\r\n        }\r\n        const currentIndex = playlist.findIndex((s) => s.id === currentTrack.id);\r\n        if (currentIndex > 0) {\r\n            playTrack(playlist[currentIndex - 1]);\r\n        } else {\r\n            seek(0);\r\n        }\r\n    };\r\n\r\n    const setVolume = (vol: number) => {\r\n        setVolumeState(vol);\r\n        if (vol > 0 && isMuted) setIsMuted(false);\r\n    };\r\n\r\n    const toggleMute = () => {\r\n        setIsMuted(!isMuted);\r\n    };\r\n\r\n    const seek = (time: number) => {\r\n        if (audioRef.current) {\r\n            audioRef.current.currentTime = time;\r\n            setCurrentTime(time);\r\n        }\r\n    };\r\n\r\n    // Audio Event Handlers\r\n    const onTimeUpdate = () => {\r\n        if (audioRef.current) {\r\n            setCurrentTime(audioRef.current.currentTime);\r\n        }\r\n    };\r\n\r\n    const onLoadedMetadata = () => {\r\n        if (audioRef.current) {\r\n            setDuration(audioRef.current.duration);\r\n        }\r\n    };\r\n\r\n    const onEnded = () => {\r\n        playNext();\r\n    };\r\n\r\n    return (\r\n        <PlayerContext.Provider\r\n            value={{\r\n                currentTrack,\r\n                playlist,\r\n                isPlaying,\r\n                volume,\r\n                isMuted,\r\n                currentTime,\r\n                duration,\r\n                playTrack,\r\n                togglePlay,\r\n                setPlaylist,\r\n                playNext,\r\n                playPrev,\r\n                setVolume,\r\n                toggleMute,\r\n                seek,\r\n                audioRef,\r\n            }}\r\n        >\r\n            <audio\r\n                ref={audioRef}\r\n                src={currentTrack?.songUrl}\r\n                onTimeUpdate={onTimeUpdate}\r\n                onLoadedMetadata={onLoadedMetadata}\r\n                onEnded={onEnded}\r\n            />\r\n            {children}\r\n        </PlayerContext.Provider>\r\n    );\r\n}\r\n\r\nexport function usePlayer() {\r\n    const context = useContext(PlayerContext);\r\n    if (context === undefined) {\r\n        throw new Error(\"usePlayer must be used within a PlayerProvider\");\r\n    }\r\n    return context;\r\n}\r\n"],"names":[],"mappings":"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"}},
    {"offset": {"line": 464, "column": 0}, "map": {"version":3,"sources":["file:///X:/Apps/MelodyMakerStudio/components/ui/sonner.tsx"],"sourcesContent":["\"use client\";\n\nimport { useTheme } from \"next-themes\";\nimport { Toaster as Sonner } from \"sonner\";\n\ntype ToasterProps = React.ComponentProps<typeof Sonner>;\n\nconst Toaster = ({ ...props }: ToasterProps) => {\n  const { theme = \"system\" } = useTheme();\n\n  return (\n    <Sonner\n      theme={theme as ToasterProps[\"theme\"]}\n      className=\"toaster group\"\n      toastOptions={{\n        classNames: {\n          toast:\n            \"group toast group-[.toaster]:bg-background group-[.toaster]:text-foreground group-[.toaster]:border-border group-[.toaster]:shadow-lg\",\n          description: \"group-[.toast]:text-muted-foreground\",\n          actionButton:\n            \"group-[.toast]:bg-primary group-[.toast]:text-primary-foreground\",\n          cancelButton:\n            \"group-[.toast]:bg-muted group-[.toast]:text-muted-foreground\",\n        },\n      }}\n      {...props}\n    />\n  );\n};\n\nexport { Toaster };\n"],"names":[],"mappings":";;;;;AAEA;AACA;;;AAHA;;;AAOA,MAAM,UAAU,CAAC,EAAE,GAAG,OAAqB;;IACzC,MAAM,EAAE,QAAQ,QAAQ,EAAE,GAAG,IAAA,+JAAQ;IAErC,qBACE,6LAAC,sJAAM;QACL,OAAO;QACP,WAAU;QACV,cAAc;YACZ,YAAY;gBACV,OACE;gBACF,aAAa;gBACb,cACE;gBACF,cACE;YACJ;QACF;QACC,GAAG,KAAK;;;;;;AAGf;GArBM;;QACyB,+JAAQ;;;KADjC"}}]
}